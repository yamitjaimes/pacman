<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pac-Man con Fantasmas</title>
  <style>
    body {
      background: black;
      color: white;
      text-align: center;
      font-family: sans-serif;
      margin: 0;
    }
    canvas {
      display: block;
      margin: 20px auto;
      background: black;
      border: 2px solid yellow;
    }
  </style>
</head>
<body>
  <h1>PAC-MAN con Fantasmas</h1>
  <canvas id="game" width="448" height="496"></canvas>
  <script>
    // CONTENIDO DEL JUEGO AQUÍ ABAJO
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const tileSize = 16;
const rows = 31;
const cols = 28;

const map = [
  "############################",
  "#............##............#",
  "#.####.#####.##.#####.####.#",
  "#o####.#####.##.#####.####o#",
  "#.####.#####.##.#####.####.#",
  "#..........................#",
  "#.####.##.########.##.####.#",
  "#.####.##.########.##.####.#",
  "#......##....##....##......#",
  "######.##### ## #####.######",
  "     #.##### ## #####.#     ",
  "     #.##          ##.#     ",
  "     #.## ###--### ##.#     ",
  "######.## #      # ##.######",
  "      .   #      #   .      ",
  "######.## #      # ##.######",
  "     #.## ######## ##.#     ",
  "     #.##          ##.#     ",
  "     #.## ######## ##.#     ",
  "######.## ######## ##.######",
  "#............##............#",
  "#.####.#####.##.#####.####.#",
  "#.####.#####.##.#####.####.#",
  "#o..##................##..o#",
  "###.##.##.########.##.##.###",
  "###.##.##.########.##.##.###",
  "#......##....##....##......#",
  "#.##########.##.##########.#",
  "#.##########.##.##########.#",
  "#..........................#",
  "############################"
];

const directions = {
  ArrowLeft: { x: -1, y: 0 },
  ArrowRight: { x: 1, y: 0 },
  ArrowUp: { x: 0, y: -1 },
  ArrowDown: { x: 0, y: 1 }
};

let score = 0;

const pacman = {
  x: 14,
  y: 23,
  dx: 0,
  dy: 0,
  nextDx: 0,
  nextDy: 0,
  radius: tileSize / 2,
  speed: 1
};

const ghosts = [
  { x: 13, y: 14, color: "red", dx: 0, dy: -1 },
  { x: 14, y: 14, color: "pink", dx: 0, dy: 1 },
  { x: 13, y: 15, color: "cyan", dx: 1, dy: 0 },
  { x: 14, y: 15, color: "orange", dx: -1, dy: 0 }
];

const pellets = [];

for (let row = 0; row < rows; row++) {
  for (let col = 0; col < cols; col++) {
    if (map[row][col] === "." || map[row][col] === "o") {
      pellets.push({ x: col, y: row, big: map[row][col] === "o", eaten: false });
    }
  }
}

function drawMap() {
  for (let row = 0; row < rows; row++) {
    for (let col = 0; col < cols; col++) {
      if (map[row][col] === "#") {
        ctx.fillStyle = "blue";
        ctx.fillRect(col * tileSize, row * tileSize, tileSize, tileSize);
      }
    }
  }

  for (const p of pellets) {
    if (!p.eaten) {
      ctx.fillStyle = "white";
      const r = p.big ? 4 : 2;
      ctx.beginPath();
      ctx.arc(p.x * tileSize + tileSize / 2, p.y * tileSize + tileSize / 2, r, 0, Math.PI * 2);
      ctx.fill();
    }
  }
}

function drawPacman() {
  ctx.fillStyle = "yellow";
  ctx.beginPath();
  ctx.arc(
    pacman.x * tileSize + tileSize / 2,
    pacman.y * tileSize + tileSize / 2,
    pacman.radius,
    0.2 * Math.PI,
    1.8 * Math.PI
  );
  ctx.lineTo(pacman.x * tileSize + tileSize / 2, pacman.y * tileSize + tileSize / 2);
  ctx.fill();
}

function drawGhosts() {
  for (const g of ghosts) {
    const centerX = g.x * tileSize + tileSize / 2;
    const centerY = g.y * tileSize + tileSize / 2;

    const ghostTop = centerY - 8;
    const ghostBottom = centerY + 8;

    ctx.fillStyle = g.color;

    // Cabeza semicircular
    ctx.beginPath();
    ctx.arc(centerX, ghostTop + 8, 8, Math.PI, 0, false);
    ctx.fill();

    // Cuerpo rectangular
    ctx.fillRect(centerX - 8, ghostTop + 8, 16, 8);

    // Ondulaciones en la parte inferior
    ctx.beginPath();
    for (let i = 0; i < 4; i++) {
      const x = centerX - 8 + i * 4;
      ctx.arc(x + 2, ghostBottom, 2, 0, Math.PI, true);
    }
    ctx.fill();

    // Ojos (opcional)
    ctx.fillStyle = "white";
    ctx.beginPath();
    ctx.arc(centerX - 4, ghostTop + 6, 2, 0, Math.PI * 2);
    ctx.arc(centerX + 4, ghostTop + 6, 2, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.arc(centerX - 4, ghostTop + 6, 1, 0, Math.PI * 2);
    ctx.arc(centerX + 4, ghostTop + 6, 1, 0, Math.PI * 2);
    ctx.fill();
  }
}

function canMove(x, y) {
  return map[y] && map[y][x] !== "#";
}

function moveEntity(entity) {
  const newX = entity.x + entity.dx;
  const newY = entity.y + entity.dy;
  if (canMove(newX, newY)) {
    entity.x = newX;
    entity.y = newY;
  } else {
    // Cambiar dirección aleatoriamente si no puede avanzar
    const options = [
  { dx: 1, dy: 0 },
  { dx: -1, dy: 0 },
  { dx: 0, dy: 1 },
  { dx: 0, dy: -1 }
];

    const valid = options.filter(opt => canMove(entity.x + opt.dx, entity.y + opt.dy));
    if (valid.length > 0) {
      const chosen = valid[Math.floor(Math.random() * valid.length)];
      entity.dx = chosen.dx;
      entity.dy = chosen.dy;
    }
  }
}
function update() {
  // Movimiento centrado en grilla
  if (canMove(pacman.x + pacman.nextDx, pacman.y + pacman.nextDy)) {
    pacman.dx = pacman.nextDx;
    pacman.dy = pacman.nextDy;
  }

  const nextX = pacman.x + pacman.dx;
  const nextY = pacman.y + pacman.dy;

  if (canMove(nextX, nextY)) {
    pacman.x = nextX;
    pacman.y = nextY;
  }

  // Comer pellets
  for (const p of pellets) {
    if (!p.eaten && p.x === pacman.x && p.y === pacman.y) {
      p.eaten = true;
      score += p.big ? 50 : 10;
    }
  }

  // Mover fantasmas
  for (const g of ghosts) {
    moveEntity(g);
    // Detectar colisión con Pac-Man
    if (g.x === pacman.x && g.y === pacman.y) {
      alert("¡Te atrapó un fantasma! Puntuación: " + score);
      location.reload();
    }
  }
}

function drawScore() {
  ctx.fillStyle = "white";
  ctx.font = "16px Arial";
  ctx.fillText("Score: " + score, 10, canvas.height - 10);
}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawMap();
  update();
  drawPacman();
  drawGhosts();
  drawScore();
  setTimeout(gameLoop, 150); // Velocidad
}

document.addEventListener("keydown", (e) => {
  if (directions[e.key]) {
    pacman.nextDx = directions[e.key].x;
    pacman.nextDy = directions[e.key].y;
  }
});

gameLoop();
  </script>
</body>
</html>
